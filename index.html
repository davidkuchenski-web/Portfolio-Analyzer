<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portfolio Rebalancing Analyzer</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  ::selection { background: rgba(118, 185, 0, 0.3); }
  body {
    min-height: 100vh;
    background: #0D1117;
    color: #E2E8F0;
    font-family: 'Söhne', 'Helvetica Neue', -apple-system, sans-serif;
    padding: 32px 24px;
    line-height: 1.5;
  }
  .mono { font-family: 'JetBrains Mono', monospace; }
  .container { max-width: 1000px; margin: 0 auto; }
  .label-sm {
    font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em;
    color: #718096; font-weight: 600; margin-bottom: 10px;
  }

/* Slider styling */
input[type=“range”] {
-webkit-appearance: none; appearance: none;
width: 100%; height: 6px;
background: rgba(255,255,255,0.08); border-radius: 4px; outline: none;
cursor: pointer;
}
input[type=“range”]::-webkit-slider-thumb {
-webkit-appearance: none; width: 16px; height: 16px;
border-radius: 50%; background: var(–thumb-color, #76B900);
cursor: pointer; border: 2px solid rgba(255,255,255,0.2);
}
input[type=“range”]::-moz-range-thumb {
width: 16px; height: 16px; border-radius: 50%;
background: var(–thumb-color, #76B900); cursor: pointer;
border: 2px solid rgba(255,255,255,0.2);
}

.btn {
padding: 6px 14px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.08);
background: rgba(255,255,255,0.03); color: #A0AEC0; font-size: 12px;
font-weight: 500; cursor: pointer; transition: all 0.2s ease;
}
.btn.active { border-color: rgba(118, 185, 0, 0.5); background: rgba(118, 185, 0, 0.12); color: #76B900; }
.btn:hover { background: rgba(255,255,255,0.06); }

.btn-scenario {
padding: 10px 24px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.08);
background: rgba(255,255,255,0.02); color: #718096; font-size: 14px;
font-weight: 600; cursor: pointer; flex: 1; transition: all 0.2s ease; text-align: center;
}

.view-toggle {
display: flex; gap: 2px; margin-bottom: 24px;
background: rgba(255,255,255,0.04); border-radius: 10px; padding: 3px; width: fit-content;
}
.view-toggle button {
padding: 8px 20px; border-radius: 8px; border: none;
background: transparent; color: #718096; font-size: 13px;
font-weight: 600; cursor: pointer; transition: all 0.2s ease;
}
.view-toggle button.active { background: rgba(255,255,255,0.1); color: #F7FAFC; }

.card {
background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.06);
border-radius: 12px; padding: 20px;
}
.card.highlight { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.15); }

.grid-main { display: grid; grid-template-columns: 320px 1fr; gap: 24px; }
@media (max-width: 768px) { .grid-main { grid-template-columns: 1fr; } }

table { width: 100%; border-collapse: collapse; font-size: 13px; }
th { padding: 8px 10px; color: #718096; font-weight: 500; font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid rgba(255,255,255,0.1); }
td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.04); }
.text-right { text-align: right; }
.text-left { text-align: left; }
.text-center { text-align: center; }

.minibar { display: flex; border-radius: 5px; overflow: hidden; width: 100%; }
.minibar div { transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1); }

.save-input {
flex: 1; padding: 8px 12px; border-radius: 8px;
border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.04);
color: #E2E8F0; font-size: 13px; outline: none;
}
.save-input:focus { border-color: rgba(118, 185, 0, 0.4); }
.save-btn {
padding: 8px 16px; border-radius: 8px; border: none;
background: #76B900; color: #0D1117; font-size: 13px;
font-weight: 700; cursor: pointer; transition: opacity 0.2s;
}
.save-btn:hover { opacity: 0.85; }

.total-bar {
display: flex; justify-content: space-between; align-items: center;
padding: 8px 12px; border-radius: 8px; margin-top: 8px;
}
.total-bar.valid { background: rgba(72, 187, 120, 0.1); border: 1px solid rgba(72, 187, 120, 0.3); }
.total-bar.invalid { background: rgba(245, 101, 101, 0.15); border: 1px solid rgba(245, 101, 101, 0.4); }

.disclaimer {
margin-top: 32px; padding: 16px 20px;
background: rgba(236, 201, 75, 0.06); border-radius: 10px;
border: 1px solid rgba(236, 201, 75, 0.15);
font-size: 12px; color: #A0AEC0; line-height: 1.6;
}

.risk-row { display: flex; align-items: center; gap: 16px; margin-bottom: 12px; }
.risk-label { width: 130px; font-size: 13px; color: #CBD5E0; font-weight: 500; flex-shrink: 0; }
.risk-bar-bg { flex: 1; height: 8px; background: rgba(255,255,255,0.06); border-radius: 4px; overflow: hidden; }
.risk-bar-fill { height: 100%; border-radius: 4px; transition: width 0.4s ease; }

.compare-grid { display: grid; gap: 0; font-size: 13px; }
.compare-cell { padding: 14px 12px; border-bottom: 1px solid rgba(255,255,255,0.06); }
.compare-header { padding: 10px 12px; text-align: center; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 0.08em; }

.scenario-chip {
display: inline-flex; align-items: center; gap: 8px;
padding: 6px 14px; border-radius: 8px;
background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); font-size: 13px;
}
.chip-remove { background: none; border: none; color: #718096; cursor: pointer; font-size: 16px; line-height: 1; padding: 0; }
.chip-remove:hover { color: #F56565; }

.green { color: #48BB78; } .red { color: #F56565; } .yellow { color: #ECC94B; } .white { color: #F7FAFC; } .muted { color: #A0AEC0; } .dim { color: #CBD5E0; }
.fw700 { font-weight: 700; } .fw600 { font-weight: 600; }
.hidden { display: none; }
</style>

</head>
<body>
<div class="container">

  <!-- Header -->

  <div style="margin-bottom: 32px;">
    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 6px;">
      <div style="width: 10px; height: 10px; border-radius: 2px; background: #76B900;"></div>
      <span class="label-sm" style="margin-bottom: 0;">Portfolio Rebalancing Analyzer</span>
    </div>
    <h1 style="font-size: 28px; font-weight: 700; color: #F7FAFC; line-height: 1.2;">6-Month Scenario Modeler</h1>
    <p style="font-size: 14px; color: #718096; margin-top: 6px;">
      Starting value: <span class="mono muted" id="total-display"></span> · Adjust allocations and compare scenarios across bear/base/bull cases.
    </p>
  </div>

  <!-- View Toggle -->

  <div class="view-toggle">
    <button class="active" onclick="switchView('single')" id="tab-single">Scenario Builder</button>
    <button onclick="switchView('compare')" id="tab-compare">Compare All</button>
  </div>

  <!-- SINGLE VIEW -->

  <div id="view-single">
    <div class="grid-main">
      <!-- Left: Controls -->
      <div>
        <div style="margin-bottom: 20px;">
          <div class="label-sm">Presets</div>
          <div style="display: flex; flex-wrap: wrap; gap: 6px;" id="preset-buttons"></div>
        </div>

```
    <div style="margin-bottom: 20px;">
      <div class="label-sm" style="margin-bottom: 12px;">Allocation</div>
      <div id="sliders-container"></div>
      <div class="total-bar valid" id="total-bar">
        <span style="font-size: 12px;" id="total-label">Total</span>
        <span class="mono fw700" style="font-size: 13px;" id="total-value">100.0%</span>
      </div>
    </div>

    <div style="display: flex; gap: 8px;">
      <input type="text" class="save-input" placeholder="Scenario name..." id="scenario-name-input">
      <button class="save-btn" onclick="saveScenario()">Save</button>
    </div>
  </div>

  <!-- Right: Results -->
  <div>
    <div style="display: flex; gap: 8px; margin-bottom: 16px;" id="scenario-toggle"></div>

    <!-- Summary Card -->
    <div class="card highlight" id="summary-card"></div>

    <!-- Detail Table -->
    <div class="card" style="margin-top: 20px; padding: 16px;">
      <table>
        <thead>
          <tr>
            <th class="text-left">Stock</th>
            <th class="text-right">Weight</th>
            <th class="text-right">Invested</th>
            <th class="text-right">Return</th>
            <th class="text-right">End Value</th>
            <th class="text-right">P&L</th>
          </tr>
        </thead>
        <tbody id="results-tbody"></tbody>
      </table>
    </div>

    <!-- Return Assumptions -->
    <div class="card" style="margin-top: 16px; padding: 12px 16px;">
      <div class="label-sm" style="margin-bottom: 8px;">6-Month Return Assumptions</div>
      <div id="assumptions-grid" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px;"></div>
    </div>
  </div>
</div>
```

  </div>

  <!-- COMPARE VIEW -->

  <div id="view-compare" class="hidden">
    <div style="margin-bottom: 16px;">
      <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 8px;" id="saved-chips"></div>
      <p style="font-size: 12px; color: #718096;">Save scenarios from the Builder tab to compare them here.</p>
    </div>

```
<div class="card" style="margin-bottom: 24px; padding: 20px;">
  <div class="label-sm" style="margin-bottom: 16px;">Projected 6-Month Outcomes</div>
  <div id="comparison-grid"></div>
</div>

<div class="card" style="padding: 20px;">
  <div class="label-sm" style="margin-bottom: 16px;">Risk Profile</div>
  <div id="risk-bars"></div>
</div>
```

  </div>

  <!-- Disclaimer -->

  <div class="disclaimer">
    <span class="yellow fw700">Disclaimer:</span> This tool uses simplified return/volatility estimates and does not account for correlations between assets, dividends, taxes, transaction costs, or real-world portfolio dynamics. These are illustrative scenarios, not predictions. Not financial advice — consult a qualified financial advisor before making investment decisions.
  </div>

</div>

<script>
const STOCKS = ["NVDA", "MSFT", "CRWV", "GOOG", "SNOW"];
const CURRENT_PORTFOLIO = { NVDA: 621554, MSFT: 140462, CRWV: 94119, GOOG: 61204, SNOW: 36458 };
const TOTAL = Object.values(CURRENT_PORTFOLIO).reduce((a, b) => a + b, 0);

const RETURN_ASSUMPTIONS = {
  NVDA: { bear: -0.20, base: 0.12, bull: 0.35, vol: 0.45 },
  MSFT: { bear: -0.10, base: 0.08, bull: 0.20, vol: 0.25 },
  CRWV: { bear: -0.35, base: 0.18, bull: 0.55, vol: 0.65 },
  GOOG: { bear: -0.12, base: 0.10, bull: 0.22, vol: 0.28 },
  SNOW: { bear: -0.18, base: 0.14, bull: 0.30, vol: 0.38 },
};

const COLORS = { NVDA: "#76B900", MSFT: "#00A4EF", CRWV: "#FF6B35", GOOG: "#4285F4", SNOW: "#29B5E8" };
const SCENARIO_COLORS = { bear: "#F56565", base: "#ECC94B", bull: "#48BB78" };
const SCENARIO_LABELS = { bear: "Bear", base: "Base", bull: "Bull" };

const PRESETS = {
  current: { label: "Current (As-Is)", alloc: { NVDA: 65.1, MSFT: 14.7, CRWV: 9.9, GOOG: 6.4, SNOW: 3.8 } },
  balanced_ai: { label: "Balanced AI", alloc: { NVDA: 35, MSFT: 25, CRWV: 15, GOOG: 15, SNOW: 10 } },
  aggressive: { label: "Growth Tilt", alloc: { NVDA: 45, MSFT: 10, CRWV: 25, GOOG: 10, SNOW: 10 } },
  conservative: { label: "Blue Chip Heavy", alloc: { NVDA: 25, MSFT: 30, CRWV: 10, GOOG: 30, SNOW: 5 } },
};

// State
let alloc = { ...PRESETS.current.alloc };
let activePreset = "current";
let scenarioType = "base";
let currentView = "single";
let savedScenarios = [{ label: "Current", alloc: { ...PRESETS.current.alloc } }];

// Helpers
const fmt = n => "$" + Math.round(n).toLocaleString();
const fmtPct = n => (n >= 0 ? "+" : "") + (n * 100).toFixed(1) + "%";
const fmtDelta = n => (n >= 0 ? "+" : "-") + "$" + Math.round(Math.abs(n)).toLocaleString();

function computeScenario(a, sc) {
  let totalValue = 0, portfolioVol = 0;
  const details = {};
  STOCKS.forEach(s => {
    const w = a[s] / 100;
    const invested = TOTAL * w;
    const ret = RETURN_ASSUMPTIONS[s][sc];
    const endValue = invested * (1 + ret);
    details[s] = { invested, endValue, ret, weight: w };
    totalValue += endValue;
    portfolioVol += Math.pow(w * RETURN_ASSUMPTIONS[s].vol, 2);
  });
  portfolioVol = Math.sqrt(portfolioVol);
  const gain = totalValue - TOTAL;
  return { totalValue, gain, pctReturn: gain / TOTAL, portfolioVol, details };
}

function miniBarHTML(a, h = 6) {
  return `<div class="minibar" style="height:${h}px">${STOCKS.map(s => `<div style="width:${a[s]}%;background:${COLORS[s]}"></div>`).join("")}</div>`;
}

// Render functions
function renderPresets() {
  const el = document.getElementById("preset-buttons");
  el.innerHTML = Object.entries(PRESETS).map(([key, val]) =>
    `<button class="btn ${activePreset === key ? 'active' : ''}" onclick="applyPreset('${key}')">${val.label}</button>`
  ).join("");
}

function renderSliders() {
  const el = document.getElementById("sliders-container");
  el.innerHTML = STOCKS.map(s => `
    <div style="margin-bottom:12px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">
        <span class="mono fw600" style="font-size:13px;color:${COLORS[s]}">${s}</span>
        <span class="mono" style="font-size:13px;color:#A0AEC0" id="slider-val-${s}">${alloc[s].toFixed(1)}%</span>
      </div>
      <input type="range" min="0" max="100" step="0.5" value="${alloc[s]}"
        style="--thumb-color:${COLORS[s]};accent-color:${COLORS[s]}"
        oninput="updateAlloc('${s}', this.value)">
    </div>
  `).join("");
  updateTotalBar();
}

function updateTotalBar() {
  const total = STOCKS.reduce((sum, s) => sum + alloc[s], 0);
  const isValid = Math.abs(total - 100) < 0.5;
  const bar = document.getElementById("total-bar");
  bar.className = `total-bar ${isValid ? 'valid' : 'invalid'}`;
  const color = isValid ? "#48BB78" : "#F56565";
  document.getElementById("total-label").style.color = color;
  document.getElementById("total-value").style.color = color;
  document.getElementById("total-value").textContent = total.toFixed(1) + "%";
}

function renderScenarioToggle() {
  const el = document.getElementById("scenario-toggle");
  el.innerHTML = ["bear", "base", "bull"].map(s => {
    const active = scenarioType === s;
    const c = SCENARIO_COLORS[s];
    return `<button class="btn-scenario" style="
      border-color:${active ? c : 'rgba(255,255,255,0.08)'};
      background:${active ? c + '15' : 'rgba(255,255,255,0.02)'};
      color:${active ? c : '#718096'};
    " onclick="setScenario('${s}')">${SCENARIO_LABELS[s]}</button>`;
  }).join("");
}

function renderSummaryCard() {
  const r = computeScenario(alloc, scenarioType);
  const pos = r.gain >= 0;
  document.getElementById("summary-card").innerHTML = `
    <div style="margin-bottom:12px">${miniBarHTML(alloc)}</div>
    <div style="display:flex;justify-content:space-between;align-items:baseline;flex-wrap:wrap;gap:8px">
      <span class="mono fw700 white" style="font-size:24px">${fmt(r.totalValue)}</span>
      <span class="mono fw600 ${pos ? 'green' : 'red'}" style="font-size:14px">${fmtDelta(r.gain)} (${fmtPct(r.pctReturn)})</span>
    </div>
  `;
}

function renderResultsTable() {
  const r = computeScenario(alloc, scenarioType);
  let html = "";
  STOCKS.forEach(s => {
    const d = r.details[s];
    const pl = d.endValue - d.invested;
    html += `<tr>
      <td class="text-left mono fw700" style="color:${COLORS[s]}">${s}</td>
      <td class="text-right mono dim">${(d.weight * 100).toFixed(1)}%</td>
      <td class="text-right mono dim">${fmt(d.invested)}</td>
      <td class="text-right mono ${d.ret >= 0 ? 'green' : 'red'}">${fmtPct(d.ret)}</td>
      <td class="text-right mono white fw600">${fmt(d.endValue)}</td>
      <td class="text-right mono fw600 ${pl >= 0 ? 'green' : 'red'}">${fmtDelta(pl)}</td>
    </tr>`;
  });
  html += `<tr style="border-top:2px solid rgba(255,255,255,0.15)">
    <td class="text-left fw700 white">Total</td>
    <td class="text-right mono dim">100%</td>
    <td class="text-right mono dim">${fmt(TOTAL)}</td>
    <td class="text-right mono fw700 ${r.gain >= 0 ? 'green' : 'red'}">${fmtPct(r.pctReturn)}</td>
    <td class="text-right mono white fw700">${fmt(r.totalValue)}</td>
    <td class="text-right mono fw700 ${r.gain >= 0 ? 'green' : 'red'}">${fmtDelta(r.gain)}</td>
  </tr>`;
  document.getElementById("results-tbody").innerHTML = html;
}

function renderAssumptions() {
  document.getElementById("assumptions-grid").innerHTML = STOCKS.map(s => `
    <div class="text-center">
      <div class="mono fw700" style="font-size:12px;color:${COLORS[s]};margin-bottom:4px">${s}</div>
      <div class="red" style="font-size:11px">${fmtPct(RETURN_ASSUMPTIONS[s].bear)}</div>
      <div class="yellow" style="font-size:11px">${fmtPct(RETURN_ASSUMPTIONS[s].base)}</div>
      <div class="green" style="font-size:11px">${fmtPct(RETURN_ASSUMPTIONS[s].bull)}</div>
    </div>
  `).join("");
}

function renderCompareView() {
  // Chips
  document.getElementById("saved-chips").innerHTML = savedScenarios.map((sc, i) =>
    `<div class="scenario-chip">
      <span style="color:#E2E8F0">${sc.label}</span>
      ${i > 0 ? `<button class="chip-remove" onclick="removeScenario(${i})">×</button>` : ''}
    </div>`
  ).join("");

  // Comparison grid
  const types = ["bear", "base", "bull"];
  let html = `<div class="compare-grid" style="grid-template-columns: 160px repeat(3, 1fr)">`;
  html += `<div class="compare-cell"></div>`;
  types.forEach(t => {
    html += `<div class="compare-header" style="border-bottom:2px solid ${SCENARIO_COLORS[t]};color:${SCENARIO_COLORS[t]}">${SCENARIO_LABELS[t]} Case</div>`;
  });
  savedScenarios.forEach(sc => {
    html += `<div class="compare-cell" style="display:flex;align-items:center;font-weight:600;color:#E2E8F0;font-size:13px">${sc.label}</div>`;
    types.forEach(t => {
      const r = computeScenario(sc.alloc, t);
      html += `<div class="compare-cell text-center" style="border-left:1px solid rgba(255,255,255,0.04)">
        <div class="mono fw700 white" style="font-size:15px">${fmt(r.totalValue)}</div>
        <div class="mono ${r.gain >= 0 ? 'green' : 'red'}" style="font-size:12px;margin-top:2px">${fmtDelta(r.gain)}</div>
      </div>`;
    });
  });
  html += `</div>`;
  document.getElementById("comparison-grid").innerHTML = html;

  // Risk bars
  const maxVol = 0.5;
  document.getElementById("risk-bars").innerHTML = savedScenarios.map(sc => {
    const baseR = computeScenario(sc.alloc, "base");
    const bearR = computeScenario(sc.alloc, "bear");
    const volPct = baseR.portfolioVol;
    const volWidth = (volPct / maxVol) * 100;
    const gradient = volPct > 0.3
      ? "linear-gradient(90deg, #ECC94B, #F56565)"
      : "linear-gradient(90deg, #48BB78, #ECC94B)";
    return `<div class="risk-row">
      <span class="risk-label">${sc.label}</span>
      <div style="flex:1">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
          <span style="font-size:10px;color:#718096;width:60px">Volatility</span>
          <div class="risk-bar-bg"><div class="risk-bar-fill" style="width:${volWidth}%;background:${gradient}"></div></div>
          <span class="mono muted" style="font-size:12px;width:50px;text-align:right">${(volPct * 100).toFixed(1)}%</span>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <span style="font-size:10px;color:#718096;width:60px">Bear loss</span>
          <span class="mono red" style="font-size:12px">${fmt(bearR.gain)}</span>
        </div>
      </div>
    </div>`;
  }).join("");
}

// Actions
function applyPreset(key) {
  activePreset = key;
  alloc = { ...PRESETS[key].alloc };
  renderAll();
}

function updateAlloc(stock, value) {
  alloc[stock] = parseFloat(value);
  activePreset = null;
  document.getElementById(`slider-val-${stock}`).textContent = alloc[stock].toFixed(1) + "%";
  updateTotalBar();
  renderPresets();
  renderSummaryCard();
  renderResultsTable();
}

function setScenario(type) {
  scenarioType = type;
  renderScenarioToggle();
  renderSummaryCard();
  renderResultsTable();
}

function switchView(view) {
  currentView = view;
  document.getElementById("view-single").classList.toggle("hidden", view !== "single");
  document.getElementById("view-compare").classList.toggle("hidden", view !== "compare");
  document.getElementById("tab-single").classList.toggle("active", view === "single");
  document.getElementById("tab-compare").classList.toggle("active", view === "compare");
  if (view === "compare") renderCompareView();
}

function saveScenario() {
  const input = document.getElementById("scenario-name-input");
  const label = input.value.trim() || `Scenario ${savedScenarios.length + 1}`;
  savedScenarios.push({ label, alloc: { ...alloc } });
  input.value = "";
  if (currentView === "compare") renderCompareView();
}

function removeScenario(idx) {
  savedScenarios.splice(idx, 1);
  renderCompareView();
}

function renderAll() {
  document.getElementById("total-display").textContent = fmt(TOTAL);
  renderPresets();
  renderSliders();
  renderScenarioToggle();
  renderSummaryCard();
  renderResultsTable();
  renderAssumptions();
}

// Init
renderAll();
</script>

</body>
</html>
